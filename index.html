<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recordatorio de Medicamentos</title>

<style>
:root{
  --azul:#2f80ed;
  --gris:#eef1f4;
  --card:#ffffff;
  --texto:#333;
  --borde:#d0d4d9;
  --ok:#27ae60;
}

body{
  margin:0;
  font-family: system-ui, Arial, sans-serif;
  background:var(--gris);
  color:var(--texto);
}

.header{
  padding:20px;
  background:#f7f9fb;
  text-align:center;
}

.pattern-area{ padding:20px; }

.card{
  max-width:420px;
  margin:0 auto 16px;
  background:var(--card);
  padding:22px;
  border-radius:18px;
  box-shadow:0 14px 32px rgba(0,0,0,.15);
}

.row{ margin-top:14px; }
.label{ font-size:14px; font-weight:600; color:#555; margin-bottom:6px; }

input, button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--borde);
  font-size:16px;
}

button{
  background:var(--azul);
  color:white;
  font-weight:700;
  border:none;
  cursor:pointer;
  margin-top:18px;
}

.secondary{ background:#6c757d; }
.ok{ background:var(--ok); }

.hidden{ display:none; }

.list-item{
  border:1px solid var(--borde);
  border-radius:14px;
  padding:14px;
  margin-top:12px;
}

.badge{
  display:inline-block;
  background:#eef3ff;
  color:#2f80ed;
  padding:6px 10px;
  border-radius:10px;
  font-size:13px;
  margin:4px 4px 0 0;
}

.toggle{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px;
  border-radius:14px;
  background:#f3f5f7;
  cursor:pointer;
}

.toggle input{ display:none; }

.switch{
  width:48px;
  height:26px;
  background:#ccc;
  border-radius:13px;
  position:relative;
  transition:.2s;
}

.switch::after{
  content:"";
  width:22px;
  height:22px;
  background:#fff;
  border-radius:50%;
  position:absolute;
  top:2px;
  left:2px;
  transition:.2s;
}

input:checked + .switch{
  background:var(--azul);
}

input:checked + .switch::after{
  transform:translateX(22px);
}

img.med-img{
  width:100%;
  max-height:160px;
  object-fit:contain;
  border-radius:12px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="header">
  <h1>üíä Recordatorio de Medicamentos</h1>
  <div>Tratamientos</div>
</div>

<div class="pattern-area">

  <!-- PERFIL -->
  <div class="card" id="perfilResumen"></div>

  <!-- LISTA -->
  <div class="card">
    <h3>Tratamientos activos</h3>
    <div id="lista"></div>
    <button onclick="mostrarForm()">Agregar medicamento</button>
  </div>

  <!-- FORMULARIO -->
  <div class="card hidden" id="formMed">

    <div class="row">
      <div class="label">Nombre del medicamento</div>
      <input id="medNombre">
    </div>

    <div class="row">
      <div class="label">Dosis</div>
      <input id="medDosis">
    </div>

    <div class="row">
      <div class="label">Lugar donde se guarda</div>
      <input id="medLugar">
    </div>

    <div class="row">
      <div class="label">Foto de la caja (opcional)</div>
      <input type="file" id="medFoto" accept="image/*">
    </div>

    <div class="row toggle" onclick="togglePermanente()">
      <span>Medicamento permanente</span>
      <label>
        <input type="checkbox" id="medPermanente">
        <div class="switch"></div>
      </label>
    </div>

    <div class="row" id="diasRow">
      <div class="label">D√≠as de duraci√≥n</div>
      <input type="number" id="medDias" min="1">
    </div>

    <div class="row">
      <div class="label">Horarios</div>
      <input type="time" id="horaInput">
      <button class="secondary" onclick="agregarHora()">Agregar horario</button>
      <div id="horas"></div>
    </div>

    <button class="ok" onclick="guardarMed()">Guardar medicamento</button>
    <button class="secondary" onclick="ocultarForm()">Cancelar</button>
  </div>

</div>

<script>
// PERFIL
const usuario = JSON.parse(localStorage.getItem("usuario"));
perfilResumen.innerHTML = `
  <strong>${usuario.nombre}</strong><br>
  Cuidador: ${usuario.cuidadorNombre}<br>
  Voz: ${usuario.voz ? "S√≠" : "No"} ¬∑ Vibraci√≥n: ${usuario.vibracion ? "S√≠" : "No"}
`;

// TRATAMIENTOS
let tratamientos = JSON.parse(localStorage.getItem("tratamientos")) || [];
let horasTemp = [];
let fotoTemp = null;

medFoto.addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;
  const r = new FileReader();
  r.onload = () => fotoTemp = r.result;
  r.readAsDataURL(file);
});

function togglePermanente(){
  medPermanente.checked = !medPermanente.checked;
  diasRow.style.display = medPermanente.checked ? "none" : "block";
}

function renderLista(){
  lista.innerHTML = "";
  tratamientos.forEach((t,i)=>{
    lista.innerHTML += `
      <div class="list-item">
        ${t.foto ? `<img class="med-img" src="${t.foto}">` : ""}
        <strong>${t.nombre}</strong><br>
        Dosis: ${t.dosis}<br>
        üìç ${t.lugar}<br>
        ${t.permanente ? "‚ôæÔ∏è Permanente" : `‚è≥ ${t.dias} d√≠as`}<br>
        Horarios: ${t.horarios.join(", ")}
        <button class="secondary" onclick="eliminar(${i})">Eliminar</button>
      </div>
    `;
  });
}

function mostrarForm(){ formMed.classList.remove("hidden"); }
function ocultarForm(){
  formMed.classList.add("hidden");
  horasTemp = [];
  fotoTemp = null;
  horas.innerHTML = "";
  medFoto.value = "";
  medPermanente.checked = false;
  diasRow.style.display = "block";
}

function agregarHora(){
  if(!horaInput.value) return;
  horasTemp.push(horaInput.value);
  horaInput.value="";
  horas.innerHTML = horasTemp.map(h=>`<span class="badge">${h}</span>`).join("");
}

function guardarMed(){
  if(!medNombre.value || !medDosis.value || !medLugar.value || horasTemp.length===0){
    alert("Complete todos los campos obligatorios");
    return;
  }

  if(!medPermanente.checked && !medDias.value){
    alert("Indique la duraci√≥n o marque como permanente");
    return;
  }

  tratamientos.push({
    nombre: medNombre.value,
    dosis: medDosis.value,
    lugar: medLugar.value,
    horarios: horasTemp,
    dias: medPermanente.checked ? null : medDias.value,
    permanente: medPermanente.checked,
    inicio: new Date().toISOString().slice(0,10),
    foto: fotoTemp
  });

  localStorage.setItem("tratamientos", JSON.stringify(tratamientos));
  medNombre.value = medDosis.value = medLugar.value = medDias.value = "";
  ocultarForm();
  renderLista();
}

function eliminar(i){
  tratamientos.splice(i,1);
  localStorage.setItem("tratamientos", JSON.stringify(tratamientos));
  renderLista();
}

renderLista();
</script>

</body>
</html>
