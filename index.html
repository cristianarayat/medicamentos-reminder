<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recordatorio de Medicamentos</title>

<style>
:root{
  --azul:#2f80ed;
  --gris:#eef1f4;
  --card:#ffffff;
  --texto:#333;
  --borde:#d0d4d9;
  --ok:#27ae60;
}

body{
  margin:0;
  font-family: system-ui, Arial, sans-serif;
  background:var(--gris);
  color:var(--texto);
}

.header{
  padding:20px;
  background:#f7f9fb;
  text-align:center;
}

.pattern-area{ padding:20px; }

.card{
  max-width:420px;
  margin:0 auto 16px;
  background:var(--card);
  padding:22px;
  border-radius:18px;
  box-shadow:0 14px 32px rgba(0,0,0,.15);
}

.row{ margin-top:14px; }
.label{ font-size:14px; font-weight:600; color:#555; margin-bottom:6px; }

input, button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--borde);
  font-size:16px;
}

button{
  background:var(--azul);
  color:white;
  font-weight:700;
  border:none;
  cursor:pointer;
  margin-top:18px;
}

.secondary{ background:#6c757d; }
.ok{ background:var(--ok); }

.hidden{ display:none; }

.list-item{
  border:1px solid var(--borde);
  border-radius:14px;
  padding:14px;
  margin-top:12px;
}

.badge{
  display:inline-block;
  background:#eef3ff;
  color:#2f80ed;
  padding:6px 10px;
  border-radius:10px;
  font-size:13px;
  margin:4px 4px 0 0;
}

img.med-img{
  width:100%;
  max-height:160px;
  object-fit:contain;
  border-radius:12px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="header">
  <h1> Recordatorio de Medicamentos</h1>
  <div>Tratamientos</div>
</div>

<div class="pattern-area">

  <!-- PERFIL RESUMEN -->
  <div class="card" id="perfilResumen"></div>

  <!-- LISTA TRATAMIENTOS -->
  <div class="card">
    <h3>Tratamientos activos</h3>
    <div id="lista"></div>
    <button onclick="mostrarForm()">Agregar medicamento</button>
  </div>

  <!-- FORMULARIO MEDICAMENTO -->
  <div class="card hidden" id="formMed">

    <div class="row">
      <div class="label">Nombre del medicamento</div>
      <input id="medNombre">
    </div>

    <div class="row">
      <div class="label">Dosis</div>
      <input id="medDosis" placeholder="Ej: 1 comprimido">
    </div>

    <div class="row">
      <div class="label">Lugar donde se guarda</div>
      <input id="medLugar" placeholder="Ej: Velador del dormitorio">
    </div>

    <div class="row">
      <div class="label">Foto de la caja (opcional)</div>
      <input type="file" id="medFoto" accept="image/*">
    </div>

    <div class="row">
      <div class="label">Horarios</div>
      <input type="time" id="horaInput">
      <button class="secondary" onclick="agregarHora()">Agregar horario</button>
      <div id="horas"></div>
    </div>

    <div class="row">
      <div class="label">D铆as de duraci贸n</div>
      <input type="number" id="medDias" min="1">
    </div>

    <button class="ok" onclick="guardarMed()">Guardar medicamento</button>
    <button class="secondary" onclick="ocultarForm()">Cancelar</button>
  </div>

</div>

<script>
// ===== PERFIL =====
const usuario = JSON.parse(localStorage.getItem("usuario"));
perfilResumen.innerHTML = `
  <strong>${usuario.nombre}</strong><br>
  Cuidador: ${usuario.cuidadorNombre}<br>
  Voz: ${usuario.voz ? "S铆" : "No"} 路 Vibraci贸n: ${usuario.vibracion ? "S铆" : "No"}
`;

// ===== TRATAMIENTOS =====
let tratamientos = JSON.parse(localStorage.getItem("tratamientos")) || [];
let horasTemp = [];
let fotoTemp = null;

// Foto
medFoto.addEventListener("change", function(){
  const file = this.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => fotoTemp = reader.result;
  reader.readAsDataURL(file);
});

function renderLista(){
  lista.innerHTML = "";
  tratamientos.forEach((t,i)=>{
    lista.innerHTML += `
      <div class="list-item">
        ${t.foto ? `<img class="med-img" src="${t.foto}">` : ""}
        <strong>${t.nombre}</strong><br>
        Dosis: ${t.dosis}<br>
         Lugar: <strong>${t.lugar}</strong><br>
        Horarios: ${t.horarios.join(", ")}<br>
        Duraci贸n: ${t.dias} d铆as
        <button class="secondary" onclick="eliminar(${i})">Eliminar</button>
      </div>
    `;
  });
}

function mostrarForm(){
  formMed.classList.remove("hidden");
}

function ocultarForm(){
  formMed.classList.add("hidden");
  horasTemp = [];
  fotoTemp = null;
  horas.innerHTML = "";
  medFoto.value = "";
}

function agregarHora(){
  if(!horaInput.value) return;
  horasTemp.push(horaInput.value);
  horaInput.value="";
  horas.innerHTML = horasTemp.map(h=>`<span class="badge">${h}</span>`).join("");
}

function guardarMed(){
  if(!medNombre.value || !medDosis.value || !medLugar.value || !medDias.value || horasTemp.length===0){
    alert("Complete todos los campos obligatorios");
    return;
  }

  tratamientos.push({
    nombre: medNombre.value,
    dosis: medDosis.value,
    lugar: medLugar.value,
    horarios: horasTemp,
    dias: medDias.value,
    inicio: new Date().toISOString().slice(0,10),
    activo:true,
    foto: fotoTemp
  });

  localStorage.setItem("tratamientos", JSON.stringify(tratamientos));

  medNombre.value = medDosis.value = medLugar.value = medDias.value = "";
  ocultarForm();
  renderLista();
}

function eliminar(i){
  tratamientos.splice(i,1);
  localStorage.setItem("tratamientos", JSON.stringify(tratamientos));
  renderLista();
}

renderLista();
</script>

</body>
</html>
